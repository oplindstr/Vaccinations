// MongoDB Playground
// Use Ctrl+Space inside a snippet or a string literal to trigger completions.

// The current database to use.
use('Vaccinations');

// Search for documents in the current collection.

db.order.aggregate(
  [
    {
      $lookup:
        {
          from: "vaccination",
          localField: "id",
          foreignField: "sourceBottle",
          as: "vaccination"
        }
    },
    {
      $unwind: {
        path: "$vaccination"
      }
    },
    {
      $match:
      { $and :
        [
          {"arrived" : { "$lt" : "2021-04-12T11:10:06.473587Z" }},
          {"vaccinationDate" : { "$lt" : "2021-04-12T11:10:06.473587Z" }} 
        ]
      }
    },
    {
      $count:"id"
    }
    /*
    {
      $project:
      {
        arrived: "$arrived",
        vaccinationDate: "$vaccination.vaccinationDate"
      }
    }
    */
  ]
)

/*
db.order.aggregate(
  [
    {
      $lookup:
        {
          from: "vaccination",
          localField: "id",
          foreignField: "sourceBottle",
          as: "vaccinations"
        }
    },
    {
      $project:
        {
          _id: 0,
          id: 1,
          orderNumber: 1,
          responsiblePerson: 1,
          healthCareDistrict: 1,
          vaccine: 1,
          injections: 1,
          arrived: 1,
          usedInjections: { $size: "$vaccinations" }
        }
    }
  ]
)
*/

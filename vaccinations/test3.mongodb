// MongoDB Playground
// Use Ctrl+Space inside a snippet or a string literal to trigger completions.

// The current database to use.
use('Vaccinations');

// Search for documents in the current collection.

db.order.aggregate(
  [
    { 
      $match: 
      { 
        $expr: 
        {
          $lt: 
          [ 
            "$arrived", 
            {
              $dateToString: 
              {
                date: {
                  $dateSubtract: {
                    startDate: { $toDate: "2021-04-12T11:10:06.473587Z" },
                    unit: "day",
                    amount: 30
                  }
                }
              }
            }
          ]
          
        }
      }
    },
    /**
     * specifications: The fields to
     *   include or exclude.
     */
    {
      $project: 
      {
        arrived: 1,
        diff: 
          {
            $dateToString: {
              date: {
                $dateSubtract: {
                  startDate: { $toDate: "2021-04-12T11:10:06.473587Z" },
                  unit: "day",
                  amount: 30
                }
              }
            }
          }
      }
    },
    {
      $sort:
      {
        arrived: -1
      }
    }
  ]
)
